<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page Reset Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f7;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #1d1d1f;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.2s;
        }
        .button:hover {
            background: #0056cc;
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 14px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 4px;
        }
        .log-entry.info {
            background: #e3f2fd;
            color: #1565c0;
        }
        .log-entry.success {
            background: #e8f5e8;
            color: #2e7d32;
        }
        .log-entry.error {
            background: #ffebee;
            color: #c62828;
        }
        .log-entry.warning {
            background: #fff8e1;
            color: #f57c00;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        .section h3 {
            margin-top: 0;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Main Page Reset Test</h1>
        
        <div class="section">
            <h3>Socket Connection Status</h3>
            <div id="socketStatus" class="status disconnected">
                Disconnected
            </div>
            <button id="connectBtn" class="button" onclick="connectSocket()">Connect to Server</button>
            <button id="disconnectBtn" class="button" onclick="disconnectSocket()" disabled>Disconnect</button>
        </div>

        <div class="section">
            <h3>Reset Test</h3>
            <button id="resetBtn" class="button" onclick="testReset()" disabled>Send Reset Command</button>
            <button id="hotkeyBtn" class="button" onclick="testHotkeyReset()" disabled>Test 'r' Key Reset</button>
            <p><strong>Instructions:</strong></p>
            <ul>
                <li>Connect to server first</li>
                <li>Press "Send Reset Command" to test direct socket reset</li>
                <li>Press "Test 'r' Key Reset" to simulate the hotkey behavior</li>
                <li>Check the log below for communication status</li>
            </ul>
        </div>

        <div class="section">
            <h3>Communication Log</h3>
            <div id="logArea" class="log"></div>
            <button class="button" onclick="clearLog()">Clear Log</button>
        </div>

        <div class="section">
            <h3>Expected Behavior</h3>
            <ul>
                <li><strong>Socket Connection:</strong> Should connect to localhost:8000</li>
                <li><strong>Reset Command:</strong> Should send 'reset_buzzers' event to server</li>
                <li><strong>Server Response:</strong> Server should send 'buzzer_data' with 'READY'</li>
                <li><strong>Arduino Reset:</strong> If Arduino is connected, it should reset</li>
            </ul>
        </div>
    </div>

    <script>
        let socket = null;
        let isConnected = false;

        function updateSocketUI() {
            const status = document.getElementById('socketStatus');
            const connectBtn = document.getElementById('connectBtn');
            const disconnectBtn = document.getElementById('disconnectBtn');
            const resetBtn = document.getElementById('resetBtn');
            const hotkeyBtn = document.getElementById('hotkeyBtn');

            if (isConnected) {
                status.textContent = 'Connected to Server';
                status.className = 'status connected';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                resetBtn.disabled = false;
                hotkeyBtn.disabled = false;
            } else {
                status.textContent = 'Disconnected';
                status.className = 'status disconnected';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                resetBtn.disabled = true;
                hotkeyBtn.disabled = true;
            }
        }

        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logArea').innerHTML = '';
        }

        function connectSocket() {
            try {
                addLog('Connecting to server...', 'info');
                
                // Connect to the server
                socket = io('http://localhost:8000');
                
                socket.on('connect', () => {
                    isConnected = true;
                    updateSocketUI();
                    addLog('‚úÖ Connected to server successfully', 'success');
                });
                
                socket.on('disconnect', () => {
                    isConnected = false;
                    updateSocketUI();
                    addLog('‚ùå Disconnected from server', 'warning');
                });
                
                socket.on('buzzer_data', (data) => {
                    addLog(`üì° Received buzzer data: ${data}`, 'success');
                });
                
                socket.on('log', (data) => {
                    addLog(`üìù Server log: ${data.message}`, 'info');
                });
                
                socket.on('arduino_status', (data) => {
                    addLog(`üîå Arduino status: ${data.connected ? 'Connected' : 'Disconnected'}`, data.connected ? 'success' : 'warning');
                });
                
                socket.on('connect_error', (error) => {
                    addLog(`‚ùå Connection error: ${error.message}`, 'error');
                });
                
            } catch (error) {
                addLog(`‚ùå Error connecting: ${error.message}`, 'error');
            }
        }

        function disconnectSocket() {
            if (socket) {
                socket.disconnect();
                socket = null;
                isConnected = false;
                updateSocketUI();
                addLog('Disconnected from server', 'warning');
            }
        }

        function testReset() {
            if (socket && isConnected) {
                addLog('üîÑ Sending reset_buzzers event to server...', 'info');
                socket.emit('reset_buzzers');
                addLog('‚úÖ reset_buzzers event sent', 'success');
            } else {
                addLog('‚ùå Cannot send reset - not connected to server', 'warning');
            }
        }

        function testHotkeyReset() {
            addLog('üîÑ Testing hotkey reset behavior...', 'info');
            
            // Simulate what the hotkey manager does
            if (socket && isConnected) {
                // Send reset via socket (like the main page does)
                socket.emit('reset_buzzers');
                addLog('‚úÖ Hotkey reset: reset_buzzers event sent via socket', 'success');
            } else {
                addLog('‚ùå Hotkey reset: Cannot send reset - not connected to server', 'warning');
            }
            
            // Simulate local state reset
            addLog('üîÑ Hotkey reset: Resetting local game state...', 'info');
            addLog('‚úÖ Hotkey reset: Local state reset completed', 'success');
        }

        // Initialize
        updateSocketUI();
        addLog('Main Page Reset Test loaded', 'info');
        addLog('Click "Connect to Server" to begin testing', 'info');
    </script>
</body>
</html> 